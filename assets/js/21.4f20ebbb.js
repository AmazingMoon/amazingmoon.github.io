(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{464:function(s,t,a){"use strict";a.r(t);var e=a(8),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"谈一谈sidekiq-cron"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#谈一谈sidekiq-cron"}},[s._v("#")]),s._v(" 谈一谈Sidekiq-Cron")]),s._v(" "),a("h4",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("  gem "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" sidekiq \n  gem "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" sidekiq-cron\n")])])]),a("h4",{attrs:{id:"新建job"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新建job"}},[s._v("#")]),s._v(" 新建job")]),s._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FirstJob")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ApplicationJob")]),s._v("\n  queue_as "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":default")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("perform")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Article")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("create"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("title"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'first'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" text"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'this is a demo'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n")])])]),a("p",[a("em",[s._v("这里写的定时任务基于active job，其余的写法请参考"),a("a",{attrs:{href:"https://github.com/ondrejbartas/sidekiq-cron",target:"_blank",rel:"noopener noreferrer"}},[s._v("sidekiq-cron文档"),a("OutboundLink")],1)])]),s._v(" "),a("h4",{attrs:{id:"config中新建schedule-yml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#config中新建schedule-yml"}},[s._v("#")]),s._v(" /config中新建schedule.yml")]),s._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("FirstJob")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cron")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0 0 0 20 * *"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" FirstJob\n")])])]),a("p",[a("em",[s._v("上面代码的意思是每个月20号执行定时任务firstjob，关于更多cron的用法，请参考"),a("a",{attrs:{href:"http://www.nncron.ru/help/EN/working/cron-format.htm",target:"_blank",rel:"noopener noreferrer"}},[s._v("Cron Format"),a("OutboundLink")],1)])]),s._v(" "),a("h4",{attrs:{id:"config-initializers中新建sidekiq-rb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#config-initializers中新建sidekiq-rb"}},[s._v("#")]),s._v(" /config/initializers中新建sidekiq.rb")]),s._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[s._v("schedule_file "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'config/scheduler.yml'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("File")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exist"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("schedule_file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Sidekiq")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Sidekiq")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Cron")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Job")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("load_from_hash "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("YAML")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("load_file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("schedule_file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n")])])]),a("h4",{attrs:{id:"配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[s._v("#")]),s._v(" 配置")]),s._v(" "),a("p",[s._v("/config/application.rb文件中添加：")]),s._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[s._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("active_job"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("queue_adapter "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":sidekiq")]),s._v("\n")])])]),a("h4",{attrs:{id:"启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[s._v("#")]),s._v(" 启动")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("redis-server "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" sidekiq\n")])])]),a("p",[a("em",[s._v("由于redis为sidekiq提供数据存储，所以启动sidekiq前必须先启动redis,更多关于redis请参考"),a("a",{attrs:{href:"https://github.com/antirez/redis",target:"_blank",rel:"noopener noreferrer"}},[s._v("redis"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=n.exports}}]);